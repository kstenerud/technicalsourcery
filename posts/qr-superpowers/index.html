<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Giving QR Codes Superpowers - 🪄 Technical Sourcery</title><link rel=apple-touch-icon href=https://www.technicalsourcery.net/images/icons/icon-180x180.png sizes=180x180><link rel=icon href=https://www.technicalsourcery.net/images/icons/icon-32x32.png sizes=32x32 type=image/png><link rel=icon href=https://www.technicalsourcery.net/images/icons/icon-16x16.png sizes=16x16 type=image/png><link rel=icon href=https://www.technicalsourcery.net/images/icons/favicon.ico><link rel=manifest href=https://www.technicalsourcery.net/manifest.json><meta name=keywords content><meta name=description content="Harness the power of Concise Encoding to store ad-hoc binary data in QR codes!"><meta itemprop=name content="Giving QR Codes Superpowers"><meta itemprop=description content="Harness the power of Concise Encoding to store ad-hoc binary data in QR codes!"><meta itemprop=datePublished content="2022-01-06T13:10:21+02:00"><meta itemprop=dateModified content="2022-01-06T13:10:21+02:00"><meta itemprop=wordCount content="1434"><meta itemprop=image content="https://www.technicalsourcery.net/images/thumbnails/qr-superpowers.png"><meta itemprop=keywords content="encoding,qr-code,binary,structured-data,concise-encoding,"><meta property="og:title" content="Giving QR Codes Superpowers"><meta property="og:description" content="Harness the power of Concise Encoding to store ad-hoc binary data in QR codes!"><meta property="og:type" content="article"><meta property="og:url" content="https://www.technicalsourcery.net/posts/qr-superpowers/"><meta property="og:image" content="https://www.technicalsourcery.net/images/thumbnails/qr-superpowers.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-01-06T13:10:21+02:00"><meta property="article:modified_time" content="2022-01-06T13:10:21+02:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://www.technicalsourcery.net/images/thumbnails/qr-superpowers.png"><meta name=twitter:title content="Giving QR Codes Superpowers"><meta name=twitter:description content="Harness the power of Concise Encoding to store ad-hoc binary data in QR codes!"><meta name=robots content="index, follow"><link rel=stylesheet href=https://www.technicalsourcery.net/css/bundle.min.26e81a6e81a1af58c6f55615544d74911aef1dbb94607cd0125020acf540160a.css integrity="sha256-JugaboGhr1jG9VYVVE10kRrvHbuUYHzQElAgrPVAFgo=" crossorigin=anonymous><noscript><link rel=stylesheet href=https://www.technicalsourcery.net/css/bundle.min.26e81a6e81a1af58c6f55615544d74911aef1dbb94607cd0125020acf540160a.css integrity="sha256-JugaboGhr1jG9VYVVE10kRrvHbuUYHzQElAgrPVAFgo=" crossorigin=anonymous></noscript></head><body><script>const items=["mode","palette"];items.forEach(function(e){const t=localStorage.getItem("hbs-"+e);t&&document.body.parentElement.setAttribute("data-"+e,t)})</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top"><div class=container><button class=navbar-toggler type=button data-bs-toggle=collapse data-bs-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-bars"></i>
</button><a class="navbar-brand me-3" href=https://www.technicalsourcery.net/>🪄 Technical Sourcery</a>
<button class=navbar-social-share type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasSocialShare aria-controls=offcanvasSocialShare aria-label="Toggle social share">
<i class="fas fa-share-alt"></i></button><div class="offcanvas offcanvas-bottom surface" tabindex=-1 id=offcanvasSocialShare aria-labelledby=offcanvasSocialShare><div class=offcanvas-header><h3 class=offcanvas-title>Share</h3><button type=button class="btn btn-sm btn-outline-primary" data-bs-dismiss=offcanvas aria-label=Close>
<i class="fas fa-times"></i></button></div><div class=offcanvas-body><a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button" target=_blank href="https://twitter.com/intent/tweet?title=Giving%20QR%20Codes%20Superpowers&url=https%3a%2f%2fwww.technicalsourcery.net%2fposts%2fqr-superpowers%2f"><i class="fab fa-fw fa-twitter"></i> Twitter</a>
<a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button" target=_blank href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fwww.technicalsourcery.net%2fposts%2fqr-superpowers%2f"><i class="fab fa-fw fa-facebook-f"></i> Facebook</a></div></div><button class=navbar-settings type=button data-bs-toggle=offcanvas data-bs-target=#offcanvasSettings aria-controls=offcanvasSettings aria-label="Toggle settings">
<i class="fas fa-ellipsis-v"></i></button><div class="offcanvas offcanvas-end surface h-100" tabindex=-1 id=offcanvasSettings aria-labelledby=offcanvasSettings><div class=offcanvas-header><h3 class=offcanvas-title>Settings</h3><button type=button class="btn btn-sm btn-outline-primary" data-bs-dismiss=offcanvas aria-label=Close>
<i class="fas fa-times"></i></button></div><div class="offcanvas-body d-flex flex-column"><section class=setting><form class=row><div class=col-auto><label for=fontSize class=form-label><i class="fas fa-fw fa-language"></i> Language</label></div><div class="col-auto ms-auto"><div class=dropdown><a class="btn btn-sm btn-outline-primary dropdown-toggle" href=# id=languageDropdown role=button data-bs-toggle=dropdown aria-expanded=false>English</a><ul class="dropdown-menu dropdown-menu-end" aria-labelledby=languageDropdown><li><a class=dropdown-item href=https://www.technicalsourcery.net/fr/></a></li></ul></div></div></form></section><section class=setting><form class=row><div class=col-auto><label><i class="fas fa-fw fa-adjust"></i> Mode</label></div><div class="col-auto ms-auto"><div class="form-check form-switch"><input class=form-check-input type=checkbox id=modeSwitcher></div></div></form></section><section class=setting><form class="font-size-switcher-form row"><div class=col-auto><label for=fontSize class=form-label><i class="fas fa-fw fa-font"></i> Font Size</label></div><div class="col-auto ms-auto"><input type=range class=form-range min=-2 max=2 id=fontSize></div></form></section><section class="setting palettes"><form class=row><div class=col-auto><label><i class="fas fa-fw fa-palette"></i> Palette</label></div><div class="col-auto ms-auto"><a id=btnPalette class="btn btn-sm btn-outline-primary" role=button aria-label=palettePicker><i class="fas fa-eye-dropper"></i></a></div></form><div class="mt-2 d-flex visually-hidden" id=palettePicker><button type=button id=palette-blue aria-label=Blue class="btn btn-sm palette" data-palette=blue>
</button><button type=button id=palette-blue-gray aria-label="Blue Gray" class="btn btn-sm palette" data-palette=blue-gray>
</button><button type=button id=palette-brown aria-label=Brown class="btn btn-sm palette" data-palette=brown>
</button><button type=button id=palette-cyan aria-label=Cyan class="btn btn-sm palette" data-palette=cyan>
</button><button type=button id=palette-green aria-label=Green class="btn btn-sm palette" data-palette=green>
</button><button type=button id=palette-indigo aria-label=Indigo class="btn btn-sm palette" data-palette=indigo>
</button><button type=button id=palette-orange aria-label=Orange class="btn btn-sm palette" data-palette=orange>
</button><button type=button id=palette-pink aria-label=Pink class="btn btn-sm palette" data-palette=pink>
</button><button type=button id=palette-purple aria-label=Purple class="btn btn-sm palette" data-palette=purple>
</button><button type=button id=palette-red aria-label=Red class="btn btn-sm palette" data-palette=red>
</button><button type=button id=palette-teal aria-label=Teal class="btn btn-sm palette" data-palette=teal>
</button><button type=button id=palette-yellow aria-label=Yellow class="btn btn-sm palette" data-palette=yellow></button></div></section><section class="setting actions d-flex justify-content-center mt-auto"><a role=button class="d-flex flex-column align-items-center" id=pageReloader><i class="fas fa-2x fa-redo-alt"></i> Reload</a></section></div></div><div class="collapse navbar-collapse" tabindex=-1 id=navbarSupportedContent aria-labelledby=navbarSupportedContent><form class="search-bar my-1" action=https://www.technicalsourcery.net/search><div class="input-group input-group-sm"><span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
<input class="form-control rounded-pill" name=q type=search aria-label=Search></div></form><ul class="navbar-nav ms-auto"><li class=nav-item><a class=nav-link href=https://www.technicalsourcery.net/archives/><i class="fas fa-fw fa-file-archive"></i>Archives</a></li><li class=nav-item><a class=nav-link href=https://www.technicalsourcery.net/categories/><i class="fas fa-fw fa-folder"></i>Categories</a></li><li class=nav-item><a class=nav-link href=https://www.technicalsourcery.net/tags/><i class="fas fa-fw fa-tags"></i>Tags</a></li><li class=nav-item><a class=nav-link href=https://www.technicalsourcery.net/series/><i class="fas fa-fw fa-columns"></i>Series</a></li><li class="nav-item dropdown"><a class=nav-link id=navbarDropdownLinks role=button data-bs-toggle=dropdown aria-expanded=false><i class="fas fa-fw fa-chevron-circle-down"></i>Quick Links</a><ul class=dropdown-menu aria-labelledby=navbarDropdownLinks><li><a class=dropdown-item href=https://concise-encoding.org target=_blank rel="noopener noreferrer">Concise Encoding</a></li><li><a class=dropdown-item href=https://github.com/kstenerud target=_blank rel="noopener noreferrer">Github</a></li></ul></li></ul></div></div></nav></header><main role=main class=container><div class="row content"><div class=col-lg-8><div class=container><nav class="row card component" aria-label=breadcrumb><div class=card-body><ol class=breadcrumb><li class=breadcrumb-item><a href=https://www.technicalsourcery.net/>Home</a></li><li class=breadcrumb-item><a href=https://www.technicalsourcery.net/posts/>Posts</a></li><li class="breadcrumb-item active">Giving QR Codes Superpowers</li></ol></div></nav><article class="row card component mb-4 post"><div class=post-panel-wrapper><div class="d-flex flex-column component rounded post-panel"><a id=sidebarToggler class="action d-none d-lg-block" role=button><i class="fas fa-fw fa-expand-alt" data-fa-transform=rotate-45></i></a>
<a class=action data-bs-container=body data-bs-toggle=popover data-bs-html=true data-bs-placement=bottom data-bs-trigger=focus tabindex=0 role=button aria-label=Copyright data-bs-content='<a target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-nc-nd/4.0/deed.en">CC BY-NC-ND 4.0 <i class="fab fa-fw fa-creative-commons"></i><i class="fab fa-fw fa-creative-commons-by"></i><i class="fab fa-fw fa-creative-commons-nc"></i><i class="fab fa-fw fa-creative-commons-nd"></i></a>
'><i class="fas fa-fw fa-copyright"></i></a>
<a class=action data-bs-toggle=offcanvas href=#offcanvasTOC aria-controls=offcanvasTOC role=button><i class="fas fa-fw fa-list-alt"></i></a></div></div><div class=card-body><h1 class="card-title post-title">Giving QR Codes Superpowers</h1><div class=post-meta><span class=post-date title="created on 2022-01-06 11:10:21 +0000 UTC.">Jan 6, 2022
</span><span class=post-reading-time>7 min read
</span><span class=post-taxonomies><a href=https://www.technicalsourcery.net/categories/encoding/ class="badge rounded-pill post-taxonomy">encoding</a><a href=https://www.technicalsourcery.net/tags/encoding/ class="badge rounded-pill post-taxonomy">encoding</a><a href=https://www.technicalsourcery.net/tags/qr-code/ class="badge rounded-pill post-taxonomy">qr-code</a><a href=https://www.technicalsourcery.net/tags/binary/ class="badge rounded-pill post-taxonomy">binary</a><a href=https://www.technicalsourcery.net/tags/structured-data/ class="badge rounded-pill post-taxonomy">structured-data</a><a href=https://www.technicalsourcery.net/tags/concise-encoding/ class="badge rounded-pill post-taxonomy">concise-encoding</a></span></div><div class="offcanvas offcanvas-end surface h-100" tabindex=-1 id=offcanvasTOC aria-labelledby=offcanvasTOCLabel><div class=offcanvas-header><h2 class=offcanvas-title id=offcanvasTOCLabel>Table Of Contents</h5><button type=button class="btn btn-sm btn-outline-primary" data-bs-dismiss=offcanvas aria-label=Close>
<i class="fas fa-times"></i></button></div><div class=offcanvas-body><nav id=TableOfContents><ul><li><a href=#qr-codes-and-their-limitations>QR Codes and Their Limitations</a></li><li><a href=#encoding-ad-hoc-binary-data-into-qr-codes>Encoding ad-hoc binary data into QR codes</a><ul><li><a href=#example>Example</a></li></ul></li></ul></nav></div></div><div class="post-content mb-3"><p><a href=https://en.wikipedia.org/wiki/QR_code target=_blank rel="noopener noreferrer">QR codes</a>
are popular because they can store more information than bar codes, but they can&rsquo;t store binary data and have no inherent structure. In this post, I&rsquo;ll show how to overcome these limitations and give QR codes superpowers!</p><h2 id=qr-codes-and-their-limitations>QR Codes and Their Limitations</h2><p>QR codes were invented by the Japanese company Denso Wave in the mid-90s as a way to get higher information density in machine-readable optical labels. They support a number of encoding methods including numeric digits, alphanumerics, kanji, and raw text. Although the QR format does have an encoding called &ldquo;byte mode&rdquo;, each byte in this mode represents an ISO 8859-1 character, not binary data.</p><p><a href=https://symbology.dev/docs/encoding.html#extended-channel-interpolation-eci target=_blank rel="noopener noreferrer">ECI</a>
escape sequences allow encoding of nonstandard text encodings, but each escape code bloats the message with out-of-band data (they have to be long in order to minimize the chance of misinterpreting data as escapes), and still binary data is not supported 😞</p><p>If you did try to write binary data, it would either be rejected (if the decoder is conformant), or just end up garbled once a reader tries to interpret it as text (some decoders apply heuristics to guess at the intended format, complicating things even further). So there&rsquo;s no reliable way to directly encode binary data into a QR code, let alone ad-hoc structured binary data.</p><p>However, with a little creative thinking, some minor algorithmic tweaks and the <a href=https://concise-encoding.org target=_blank rel="noopener noreferrer">Concise Encoding format</a>
, it&rsquo;s possible to work around this limitation to reliably read and write binary ad-hoc structured data in QR codes for slightly modified decoders!</p><p>To see how, let&rsquo;s take a look at the text encoding used for &ldquo;byte mode&rdquo;: <strong>ISO 8859-1</strong>.</p><table><thead><tr><th></th><th>x0</th><th>x1</th><th>x2</th><th>x3</th><th>x4</th><th>x5</th><th>x6</th><th>x7</th><th>x8</th><th>x9</th><th>xA</th><th>xB</th><th>xC</th><th>xD</th><th>xE</th><th>xF</th></tr></thead><tbody><tr><td>0x</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>1x</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>2x</td><td>sp</td><td>!</td><td>"</td><td>#</td><td>$</td><td>%</td><td>&</td><td>'</td><td>(</td><td>)</td><td>*</td><td>+</td><td>,</td><td>-</td><td>.</td><td>/</td></tr><tr><td>3x</td><td>0</td><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>:</td><td>;</td><td>&lt;</td><td>=</td><td>></td><td>?</td></tr><tr><td>4x</td><td>@</td><td>A</td><td>B</td><td>C</td><td>D</td><td>E</td><td>F</td><td>G</td><td>H</td><td>I</td><td>J</td><td>K</td><td>L</td><td>M</td><td>N</td><td>O</td></tr><tr><td>5x</td><td>P</td><td>Q</td><td>R</td><td>S</td><td>T</td><td>U</td><td>V</td><td>W</td><td>X</td><td>Y</td><td>Z</td><td>[</td><td>\</td><td>]</td><td>^</td><td>_</td></tr><tr><td>6x</td><td>`</td><td>a</td><td>b</td><td>c</td><td>d</td><td>e</td><td>f</td><td>g</td><td>h</td><td>i</td><td>j</td><td>k</td><td>l</td><td>m</td><td>n</td><td>o</td></tr><tr><td>7x</td><td>p</td><td>q</td><td>r</td><td>s</td><td>t</td><td>u</td><td>v</td><td>w</td><td>x</td><td>y</td><td>z</td><td>{</td><td>|</td><td>}</td><td>~</td><td></td></tr><tr><td>8x</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>9x</td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><td>Ax</td><td>nbsp</td><td>¡</td><td>¢</td><td>£</td><td>¤</td><td>¥</td><td>¦</td><td>§</td><td>¨</td><td>©</td><td>ª</td><td>«</td><td>¬</td><td>shy</td><td>®</td><td>¯</td></tr><tr><td>Bx</td><td>°</td><td>±</td><td>²</td><td>³</td><td>´</td><td>µ</td><td>¶</td><td>·</td><td>¸</td><td>¹</td><td>º</td><td>»</td><td>¼</td><td>½</td><td>¾</td><td>¿</td></tr><tr><td>Cx</td><td>À</td><td>Á</td><td>Â</td><td>Ã</td><td>Ä</td><td>Å</td><td>Æ</td><td>Ç</td><td>È</td><td>É</td><td>Ê</td><td>Ë</td><td>Ì</td><td>Í</td><td>Î</td><td>Ï</td></tr><tr><td>Dx</td><td>Ð</td><td>Ñ</td><td>Ò</td><td>Ó</td><td>Ô</td><td>Õ</td><td>Ö</td><td>×</td><td>Ø</td><td>Ù</td><td>Ú</td><td>Û</td><td>Ü</td><td>Ý</td><td>Þ</td><td>ß</td></tr><tr><td>Ex</td><td>à</td><td>á</td><td>â</td><td>ã</td><td>ä</td><td>å</td><td>æ</td><td>ç</td><td>è</td><td>é</td><td>ê</td><td>ë</td><td>ì</td><td>í</td><td>î</td><td>ï</td></tr><tr><td>Fx</td><td>ð</td><td>ñ</td><td>ò</td><td>ó</td><td>ô</td><td>õ</td><td>ö</td><td>÷</td><td>ø</td><td>ù</td><td>ú</td><td>û</td><td>ü</td><td>ý</td><td>þ</td><td>ÿ</td></tr></tbody></table><p>Notice how the codes <strong>7f-9f</strong> are unassigned (many text formats do this for <a href=https://en.wikipedia.org/wiki/ISO/IEC_2022 target=_blank rel="noopener noreferrer">legacy reasons</a>
). This means that any non-ECI data containing these values is invalid because it can&rsquo;t be decoded as ISO 8859-1 text.</p><p><strong>Side Note</strong>: Non-conformant QR decoders might not actually validate this, which is why you sometimes get strange garbled results after decoding a QR code that was mistakenly encoded in UTF-8 without an ECI header (by a non-conformant encoder).</p><p>So even though there are no technical limitations against using them, unassigned characters are considered invalid, which means that any valid QR code will not contain them.</p><p>So, what we could do is re-purpose one of these unassigned characters and use it as a sentinel to indicate the presence of special, non-textual data. When a scanner that knows about the sentinel byte encounters it as the first byte of the payload, it can switch decoding modes reliably.</p><p>Existing standards-compliant QR decoders will still function correctly because they&rsquo;ll rightly reject the code due to the (technically invalid) sentinel byte. They won&rsquo;t be able to decode the binary data, but they also won&rsquo;t malfunction and give incorrect results.</p><h2 id=encoding-ad-hoc-binary-data-into-qr-codes>Encoding ad-hoc binary data into QR codes</h2><p><a href=https://concise-encoding.org target=_blank rel="noopener noreferrer">Concise Encoding</a>
is an ad-hoc data format with a text and a binary encoding form. In the <a href=https://github.com/kstenerud/concise-encoding/blob/master/cbe-specification.md target=_blank rel="noopener noreferrer">binary format (CBE)</a>
, all documents begin with the sentinel byte <a href=https://github.com/kstenerud/concise-encoding/blob/master/cbe-specification.md#document-version-specifier target=_blank rel="noopener noreferrer">0x81</a>
(specifically chosen because it&rsquo;s an invalid starting byte in most popular text formats, including ISO 8859 and UTF-8). We&rsquo;ll leverage this to encode a CBE document into a QR code.</p><p>I&rsquo;ve adapted <a href=https://github.com/kstenerud/enctool target=_blank rel="noopener noreferrer">https://github.com/kstenerud/enctool</a>
to support QR codes and initiate special processing when the first byte of the QR data is <code>0x81</code>. You can follow along by <a href=https://go.dev/doc/install target=_blank rel="noopener noreferrer">installing the go language on your system</a>
and then installing <code>enctool</code> like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>go install github.com/kstenerud/enctool@latest
</span></span></code></pre></div><p>This will install <code>enctool</code> into <code>$GOPATH/bin</code> (usually <code>go/bin</code> in your home directory).</p><p>We&rsquo;ll be using enctool&rsquo;s <code>convert</code> functionality. You can see the available options by typing:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>enctool convert -h
</span></span></code></pre></div><h3 id=example>Example</h3><p>As an example, let&rsquo;s say that we&rsquo;re developing a new &ldquo;international shipping and storage requirements&rdquo; QR code format.</p><p>Here&rsquo;s a sample document that we want to encode into a QR code. I&rsquo;m writing it here in the text format (<a href=https://github.com/kstenerud/concise-encoding/blob/master/cte-specification.md target=_blank rel="noopener noreferrer">CTE</a>
) for convenience, but the actual data will be written in the binary format (<a href=https://github.com/kstenerud/concise-encoding/blob/master/cbe-specification.md target=_blank rel="noopener noreferrer">CBE</a>
).</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln> 1</span><span class=cl>c1 {
</span></span><span class=line><span class=ln> 2</span><span class=cl>    &#34;temperature range&#34; = [-20 5]
</span></span><span class=line><span class=ln> 3</span><span class=cl>    &#34;hazards&#34; = [
</span></span><span class=line><span class=ln> 4</span><span class=cl>        &#34;pressurized&#34;
</span></span><span class=line><span class=ln> 5</span><span class=cl>        &#34;flammable&#34;
</span></span><span class=line><span class=ln> 6</span><span class=cl>        &#34;fragile&#34;
</span></span><span class=line><span class=ln> 7</span><span class=cl>    ]
</span></span><span class=line><span class=ln> 8</span><span class=cl>    &#34;max tilt degrees&#34; = 15
</span></span><span class=line><span class=ln> 9</span><span class=cl>    &#34;perishes after&#34; = 2022-12-05
</span></span><span class=line><span class=ln>10</span><span class=cl>}
</span></span></code></pre></div><p>Save this document as <code>with-text.cte</code>, and then convert to CBE like so:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>enctool convert -s with-text.cte -sf cte -df cbe -d with-text.cbe
</span></span></code></pre></div><p>How big is it?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>ls -l with-text.cbe
</span></span><span class=line><span class=ln>2</span><span class=cl>-rw-rw-r-- 1 karl karl 105 Jan  6 17:15 with-text.cbe
</span></span></code></pre></div><p>A whopping 105 bytes (mainly due to the many text fields the data contains). We could encode it as-is, but that would produce a pretty big QR code.</p><p>What if instead we came up with a schema that replaces all well-known text keys and values with integer enumerations? That should really shrink things!</p><p><strong>Note</strong>: For completeness sake we&rsquo;ll also include a <a href=https://en.wikipedia.org/wiki/FourCC target=_blank rel="noopener noreferrer">fourCC</a>
style identifier so that any reader can identify which schema and version the data was encoded with (let&rsquo;s say that key 0 is always used to specify the schema).</p><p><strong>Fictional Schema</strong>:</p><ul><li>0 = schema ID and version adherence: <strong>(fourCC-style integer: &ldquo;TSS&rdquo; + version)</strong></li><li>1 = temperature range: <strong>(list of two integers)</strong></li><li>2 = hazards: <strong>(list of enumerated integers)</strong>:<ul><li>0 = corrosive</li><li>1 = photoreactive</li><li>&mldr;</li><li>4 = pressurized</li><li>&mldr;</li><li>6 = flammable</li><li>&mldr;</li><li>19 = fragile</li></ul></li><li>&mldr;</li><li>4 = max tilt degrees: <strong>(integer)</strong></li><li>&mldr;</li><li>9 = perishes after: <strong>(date)</strong></li></ul><p><strong>Document (CTE)</strong>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln> 1</span><span class=cl>c1 {
</span></span><span class=line><span class=ln> 2</span><span class=cl>    0 = 0x54535301 // Transport and Storage Schema version 1 (&#34;TSS&#34; + 1)
</span></span><span class=line><span class=ln> 3</span><span class=cl>    1 = [-20 5]    // Temperature range from -20 to 5
</span></span><span class=line><span class=ln> 4</span><span class=cl>    2 = [          // Hazards:
</span></span><span class=line><span class=ln> 5</span><span class=cl>        4             // Pressurized
</span></span><span class=line><span class=ln> 6</span><span class=cl>        6             // Flammable
</span></span><span class=line><span class=ln> 7</span><span class=cl>        19            // Fragile
</span></span><span class=line><span class=ln> 8</span><span class=cl>    ]
</span></span><span class=line><span class=ln> 9</span><span class=cl>    4 = 15         // Max 15 degrees tilt
</span></span><span class=line><span class=ln>10</span><span class=cl>    9 = 2022-12-05 // Perishes after Dec 5, 2022
</span></span><span class=line><span class=ln>11</span><span class=cl>}
</span></span></code></pre></div><p>Because <a href=https://github.com/kstenerud/concise-encoding/blob/master/cbe-specification.md#type-field target=_blank rel="noopener noreferrer">integers from -100 to 100 are their own type codes in CBE</a>
(thereby encoding into a single byte), you can achieve tremendous space savings by using them as enumerated types.</p><p>Let&rsquo;s see how our modifications do (save this document as <code>with-enums.cte</code>):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>enctool convert -s with-enums.cte -sf cte -df cbe -d with-enums.cbe
</span></span></code></pre></div><p>Now how big is it?</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>ls -l with-enums.cbe 
</span></span><span class=line><span class=ln>2</span><span class=cl>-rw-rw-r-- 1 karl karl 28 Jan  6 17:22 with-enums.cbe
</span></span></code></pre></div><p>We&rsquo;ve shrunk down our payload from 105 bytes to 28 bytes! Much better!</p><p>Here are the byte contents of the CBE document. Note the first byte 0x81, which is an unassigned character in ISO 8859-1:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>81 00 99 00 6c 01 53 53 54 01 9a ec 05 9b 02 9a 04 06 13 9b 04 0f 09 7a 85 59 00 9b
</span></span></code></pre></div><p>Now let&rsquo;s encode this data into a QR code (border size 1, 400x400 pixels):</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>enctool convert -s with-enums.cte -df qr -d qr.png -b 1 -is 400
</span></span></code></pre></div><p>This creates <code>qr.png</code>, which contains our QR code:</p><figure><img src=qr.png></figure><p>Now let&rsquo;s read the data back. I&rsquo;ll convert it to CTE for convenience, printing to stdout:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln>1</span><span class=cl>enctool convert -s qr.png -sf qr -df cte
</span></span></code></pre></div><p>Output:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=ln> 1</span><span class=cl>c0
</span></span><span class=line><span class=ln> 2</span><span class=cl>{
</span></span><span class=line><span class=ln> 3</span><span class=cl>    0 = 1414746881
</span></span><span class=line><span class=ln> 4</span><span class=cl>    1 = [
</span></span><span class=line><span class=ln> 5</span><span class=cl>        -20
</span></span><span class=line><span class=ln> 6</span><span class=cl>        5
</span></span><span class=line><span class=ln> 7</span><span class=cl>    ]
</span></span><span class=line><span class=ln> 8</span><span class=cl>    2 = [
</span></span><span class=line><span class=ln> 9</span><span class=cl>        4
</span></span><span class=line><span class=ln>10</span><span class=cl>        6
</span></span><span class=line><span class=ln>11</span><span class=cl>        19
</span></span><span class=line><span class=ln>12</span><span class=cl>    ]
</span></span><span class=line><span class=ln>13</span><span class=cl>    4 = 15
</span></span><span class=line><span class=ln>14</span><span class=cl>    9 = 2022-12-05
</span></span><span class=line><span class=ln>15</span><span class=cl>}
</span></span></code></pre></div><p>Once we&rsquo;ve got our document, we can process it through the schema to recover the true meaning of the data.</p><p>So there you have it: Supercharged QR codes that can hold arbitrary structured data! Neat!</p></div><hr><div class="post-navs d-flex mb-3 justify-content-evenly"><div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-left"></i>
<a href=https://www.technicalsourcery.net/about/>About Me</a></div></div><section class=related-posts-wrapper><h3>Related Posts</h3><ul class=related-posts><li><a href=https://www.technicalsourcery.net/about/>About Me</a></li><li><a href=https://www.technicalsourcery.net/posts/nixos-in-libvirt/>Test-Driving a NixOS VM Using Libvirt</a></li><li><a href=https://www.technicalsourcery.net/posts/on-endianness/>On Endianness</a></li><li><a href=https://www.technicalsourcery.net/posts/line-lengths/>Line Lengths</a></li><li><a href=https://www.technicalsourcery.net/posts/virtual-linux-remote-desktop/>Virtual Linux Remote Desktop</a></li></ul></section></div></article><div class="card component row post-comments"><div class=card-body><script src=https://utteranc.es/client.js repo=kstenerud/technicalsourcery issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div><aside class="col-lg-4 sidebar d-flex"><div class=container><section class="card row text-center profile component"><div class=card-body><div class="col-12 d-flex align-items-center justify-content-center"><img class="profile-avatar rounded-circle" alt="Karl Stenerud" src=https://www.technicalsourcery.net/images/profile.jpg loading=lazy width=460 height=460></div><div class="col-12 profile-meta"><div class=profile-name>Karl Stenerud</div><div class=profile-bio>Networking, protocols, & nitty gritty details.</div><div class=profile-about><i class="fas fa-fw fa-user"></i><a href=https://www.technicalsourcery.net/about/>About Me</a></div></div></div></section><section class="recent-posts row card component"><div class=card-body><h2 class=card-title>Recent Posts</h2><ul class=post-list><li><a href=https://www.technicalsourcery.net/posts/qr-superpowers/>Giving QR Codes Superpowers</a></li><li><a href=https://www.technicalsourcery.net/posts/nixos-in-libvirt/>Test-Driving a NixOS VM Using Libvirt</a></li><li><a href=https://www.technicalsourcery.net/posts/on-endianness/>On Endianness</a></li><li><a href=https://www.technicalsourcery.net/posts/line-lengths/>Line Lengths</a></li><li><a href=https://www.technicalsourcery.net/posts/virtual-linux-remote-desktop/>Virtual Linux Remote Desktop</a></li></ul></div></section><section class="taxonomies row card component"><div class=card-body><h2 class=card-title><a href=https://www.technicalsourcery.net/categories>Categories</a></h2><div class=py-2><a href=https://www.technicalsourcery.net/categories/encoding/ class="badge rounded post-taxonomy" title=encoding>encoding
</a><a href=https://www.technicalsourcery.net/categories/endianness/ class="badge rounded post-taxonomy" title=endianness>endianness
</a><a href=https://www.technicalsourcery.net/categories/high-availability/ class="badge rounded post-taxonomy" title=high-availability>high-availability
</a><a href=https://www.technicalsourcery.net/categories/programming/ class="badge rounded post-taxonomy" title=programming>programming
</a><a href=https://www.technicalsourcery.net/categories/remote-desktop/ class="badge rounded post-taxonomy" title=remote-desktop>remote-desktop
</a><a href=https://www.technicalsourcery.net/categories/time/ class="badge rounded post-taxonomy" title=time>time
</a><a href=https://www.technicalsourcery.net/categories/virtualization/ class="badge rounded post-taxonomy" title=virtualization>virtualization</a></div></div></section><section class="taxonomies row card component"><div class=card-body><h2 class=card-title><a href=https://www.technicalsourcery.net/tags>Tags</a></h2><div class=py-2><a href=https://www.technicalsourcery.net/tags/binary/ class="badge rounded post-taxonomy" title=binary>binary
</a><a href=https://www.technicalsourcery.net/tags/concise-encoding/ class="badge rounded post-taxonomy" title=concise-encoding>concise-encoding
</a><a href=https://www.technicalsourcery.net/tags/encoding/ class="badge rounded post-taxonomy" title=encoding>encoding
</a><a href=https://www.technicalsourcery.net/tags/endianness/ class="badge rounded post-taxonomy" title=endianness>endianness
</a><a href=https://www.technicalsourcery.net/tags/headless/ class="badge rounded post-taxonomy" title=headless>headless
</a><a href=https://www.technicalsourcery.net/tags/high-availability/ class="badge rounded post-taxonomy" title=high-availability>high-availability
</a><a href=https://www.technicalsourcery.net/tags/libvirt/ class="badge rounded post-taxonomy" title=libvirt>libvirt
</a><a href=https://www.technicalsourcery.net/tags/linux/ class="badge rounded post-taxonomy" title=linux>linux
</a><a href=https://www.technicalsourcery.net/tags/nixos/ class="badge rounded post-taxonomy" title=nixos>nixos
</a><a href=https://www.technicalsourcery.net/tags/programming/ class="badge rounded post-taxonomy" title=programming>programming</a></div></div></section></div></aside></div></main><footer class="footer mt-auto py-3 text-center container"><nav class="social-links nav my-2 justify-content-center"><a class="nav-link social-link" href=mailto:kstenerud@gmail.com title=Email><i class="fas fa-fw fa-2x fa-envelope"></i>
</a><a class="nav-link social-link" target=_blank href=https://github.com/kstenerud title=GitHub rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-github"></i>
</a><a class="nav-link social-link" target=_blank href=https://linkedin.com/in/kstenerud title=LinkedIn rel="noopener noreferrer"><i class="fa-fw fa-2x fab fa-linkedin-in"></i></a></nav><div class="copyright mb-2">Copyright © 2018-2022 Karl Stenerud. All Rights Reserved.</div><div class="powered-by mb-2">Powered by <a href=https://gohugo.io target=_blank rel="noopener noreferrer">Hugo</a> and the <a href=https://github.com/razonyang/hugo-theme-bootstrap target=_blank rel="noopener noreferrer">Bootstrap</a> theme.</div><a href=https://www.netlify.com><img src=https://www.netlify.com/img/global/badges/netlify-color-accent.svg alt="Deploys by Netlify"></a></footer><script src=https://www.technicalsourcery.net/js/bundle.min.b153457179af39891bd03f4b8e041490f6c0660833ea10ca92bf85eeda75ff09.js integrity="sha256-sVNFcXmvOYkb0D9LjgQUkPbAZggz6hDKkr+F7tp1/wk=" crossorigin=anonymous defer></script><script>"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("https://www.technicalsourcery.net/service-worker.js").then(function(e){console.log("Successfully registered service worker",e)}).catch(function(e){console.warn("Error whilst registering service worker",e)})})</script></body></html>